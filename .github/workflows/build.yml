# HackBar å¿«é€Ÿæ„å»ºå·¥ä½œæµ
name: Quick Build

# è§¦å‘æ¡ä»¶
on:
  push:
    branches: [ "main", "master", "develop" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  quick-build:
    runs-on: ubuntu-latest
    
    steps:
    # æ£€å‡ºä»£ç 
    - name: Checkout code
      uses: actions/checkout@v4
    
    # è®¾ç½® Java 8 ç¯å¢ƒï¼ˆé¡¹ç›®ä¸»è¦ç›®æ ‡ç‰ˆæœ¬ï¼‰
    - name: Set up JDK 8
      uses: actions/setup-java@v4
      with:
        java-version: '8'
        distribution: 'temurin'
    
    # ç¼“å­˜ Gradle ä¾èµ–
    - name: Cache Gradle packages
      uses: actions/cache@v4
      with:
        path: |
          ~/.gradle/caches
          ~/.gradle/wrapper
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
        restore-keys: |
          ${{ runner.os }}-gradle-
    
    # éªŒè¯å¹¶ä¿®å¤ Gradle Wrapper
    - name: Validate Gradle wrapper
      uses: gradle/actions/wrapper-validation@v4
      continue-on-error: true
    
    # ç»™ gradlew æ‰§è¡Œæƒé™
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
    
    # å¦‚æœ wrapper æœ‰é—®é¢˜ï¼Œé‡æ–°ç”Ÿæˆ
    - name: Regenerate Gradle wrapper if needed
      run: |
        if ! ./gradlew --version; then
          echo "Gradle wrapper seems corrupted, regenerating..."
          gradle wrapper --gradle-version 8.5
        fi
      continue-on-error: true
    
    # æ„å»ºé¡¹ç›®
    - name: Build with Gradle
      run: ./gradlew clean build --no-daemon --stacktrace
    
    # æ£€æŸ¥æ„å»ºäº§ç‰©
    - name: List build artifacts
      run: |
        echo "Build directory contents:"
        ls -la build/
        echo "Libs directory contents:"
        ls -la build/libs/ || echo "No libs directory found"
    
    # ä¸Šä¼  JAR æ–‡ä»¶
    - name: Upload HackBar JAR
      uses: actions/upload-artifact@v4
      with:
        name: hackbar-extension
        path: build/libs/*.jar
        if-no-files-found: error
        retention-days: 30
    
    # æ˜¾ç¤ºæ„å»ºä¿¡æ¯
    - name: Build Summary
      run: |
        echo "âœ… HackBar æ„å»ºå®Œæˆï¼"
        echo "ğŸ“¦ JAR æ–‡ä»¶å·²ç”Ÿæˆå¹¶ä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©"
        echo "ğŸ”§ å¯ä»¥åœ¨ Actions é¡µé¢ä¸‹è½½æ„å»ºå¥½çš„æ‰©å±•æ–‡ä»¶"